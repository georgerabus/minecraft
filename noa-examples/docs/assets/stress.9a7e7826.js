import{E as F}from"./index.2b3d1184.js";import{c as R,V as k,C as T}from"./babylon.39bd9ef3.js";import{a as g}from"./terrain_atlas.162877cc.js";var e=new F({debug:!0,showFPS:!0,inverseY:!0,chunkSize:48,chunkAddDistance:[8.5,6],playerStart:[0,10,0],playerAutoStep:!0,playerShadowComponent:!1,originRebaseDistance:10});e.registry.registerMaterial("grass",{textureURL:g,atlasIndex:0});e.registry.registerMaterial("g_dirt",{textureURL:g,atlasIndex:1});e.registry.registerMaterial("dirt",{textureURL:g,atlasIndex:2});e.registry.registerMaterial("stone",{textureURL:g,atlasIndex:3});e.registry.registerMaterial("stone2",{textureURL:g,atlasIndex:4});e.registry.registerMaterial("cloud",{color:[1,1,1,.4]});var u=1,A=e.registry.registerBlock(u++,{material:"dirt"}),Q=e.registry.registerBlock(u++,{material:["grass","dirt","g_dirt"]}),x=e.registry.registerBlock(u++,{material:"stone"}),Y=e.registry.registerBlock(u++,{material:"stone2"}),G=e.registry.registerBlock(u++,{material:"cloud"}),K=(r,a,t,n,h,m,o)=>a<n?a<-1.8?x:a<1.2?A:n-a<1?Q:A:a<n+o?Y:a>h&&a<m?G:a===15&&r===-20?x:0;e.world.on("worldDataNeeded",(r,a,t,n,h)=>{if(n>40||n<-20){var m=n>0?0:x;return e.world.setChunkData(r,a,null,m)}for(var o=0;o<a.shape[0];o++)for(var d=t+o,v=0;v<a.shape[2];v++){var l=h+v,I=Math.sqrt(d*d+l*l)/100,B=y(d,150),w=y(l+50,140),_=y(d-l-50,120);I+=2*B+w+_;for(var L=Math.random()<.002?5:0,P=39+2*(w-_),z=35+2*(B-w),f=0;f<a.shape[1];f++){var E=n+f,V=K(d,E,l,I,P,z,L);a.set(o,f,v,V)}}e.world.setChunkData(r,a)});e.inputs.down.on("fire",function(){if(e.targetedBlock){var r=e.targetedBlock.position;e.setBlock(0,r[0],r[1],r[2])}});e.on("tick",function(r){var a=e.inputs.pointerState.scrolly;a!==0&&(e.camera.zoomDistance+=a>0?1:-1,e.camera.zoomDistance<0&&(e.camera.zoomDistance=0),e.camera.zoomDistance>10&&(e.camera.zoomDistance=10))});e.inputs.bind("pause","KeyP");e.inputs.down.on("pause",function(){p=!p,e.setPaused(p)});var p=!1;window.setViewDistance=(r=100)=>{r=r<50?50:r>5e3?5e3:r;var a=Math.max(1.5,r/e.world._chunkSize),t=Math.max(1.5,.5*a);e.world.setAddRemoveDistance([a,t],[a+1,t+1])};var N=e.rendering.light,O=e.rendering.camera,i=new R(1024,N,!1,O);window.gen=i;var s=100;i.shadowMaxZ=s;i.forceBackFacesOnly=!0;i.lambda=.7;i.filteringQuality=R.QUALITY_MEDIUM;i.transparencyShadow=!1;i.darkness=.5;i.autoCalcDepthBounds=!1;i.freezeShadowCastersBoundingInfo=!0;i.shadowCastersBoundingInfo.reConstruct(new k(-s,-s,-s),new k(s,s,s));e.on("addingTerrainMesh",r=>{D(r)});e.off("addingTerrainMesh",r=>{D(r,!0)});function D(r,a=!1){r.metadata||(r.metadata={});var t=!!r.metadata.noa_demo_has_shadows,n=a?!1:r.position.length()<s;n!==t&&(n?(i.addShadowCaster(r,!0),r.isAnInstance||(r.receiveShadows=!0)):(i.removeShadowCaster(r,!0),r.isAnInstance||(r.receiveShadows=!1)),r.metadata.noa_demo_has_shadows=n,r.resetDrawCache())}var M=0;e.on("tick",()=>{for(var r=e.rendering.scene.meshes,a=Math.min(30,r.length/4),t=0;t<a;t++)M>=r.length&&(M=0),D(r[M++])});var c=T("player-mesh",{},e.rendering.getScene()),C=e.entities.getPositionData(e.playerEntity);c.scaling.x=c.scaling.z=C.width;c.scaling.y=C.height;c.material=e.rendering.makeStandardMaterial();e.entities.addComponent(e.playerEntity,e.entities.names.mesh,{mesh:c,offset:[0,C.height/2,0]});var U=e.entities.getMovement(e.playerEntity);U.maxSpeed=50;U.moveForce=60;function y(r,a){var t=r/a,n=t-Math.floor(t);return Z[n*1e3|0]}var S=[0,0,0].map(Math.random),Z=Array.from(Array(1e3)).map((r,a)=>{var t=Math.cos(Math.PI*2*(a/1e3+S[0]));return t+=.5*Math.cos(Math.PI*2*(a/500+S[1])),t+=.25*Math.cos(Math.PI*2*(a/250+S[2])),t});
